% Style definitions for L5749 Summons
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{style}[2025/09/14 L5749 Summons Style]

% Dependencies
\RequirePackage{xcolor}
\RequirePackage{hyperref}
\RequirePackage{titlesec}
\RequirePackage{xstring}
\RequirePackage{tabularx}
\RequirePackage{csvsimple}
\RequirePackage{datatool}
\RequirePackage{etoolbox}
\RequirePackage{multicol}

  % Defaults for all roles
  \gdef\OfficerSalMaster{}\gdef\OfficerNameMaster{}\gdef\OfficerPostMaster{}
  \gdef\OfficerSalSeniorWarden{}\gdef\OfficerNameSeniorWarden{}\gdef\OfficerPostSeniorWarden{}
  \gdef\OfficerSalJuniorWarden{}\gdef\OfficerNameJuniorWarden{}\gdef\OfficerPostJuniorWarden{}
  \gdef\OfficerSalChaplain{}\gdef\OfficerNameChaplain{}\gdef\OfficerPostChaplain{}
  \gdef\OfficerSalTreasurer{}\gdef\OfficerNameTreasurer{}\gdef\OfficerPostTreasurer{}
  \gdef\OfficerSalSecretary{}\gdef\OfficerNameSecretary{}\gdef\OfficerPostSecretary{}
  \gdef\OfficerSalDirectorOfCeremonies{}\gdef\OfficerNameDirectorOfCeremonies{}\gdef\OfficerPostDirectorOfCeremonies{}
  \gdef\OfficerSalAlmoner{}\gdef\OfficerNameAlmoner{}\gdef\OfficerPostAlmoner{}
  \gdef\OfficerSalCharitySteward{}\gdef\OfficerNameCharitySteward{}\gdef\OfficerPostCharitySteward{}
  \gdef\OfficerSalMembershipOfficer{}\gdef\OfficerNameMembershipOfficer{}\gdef\OfficerPostMembershipOfficer{}
  \gdef\OfficerSalMentor{}\gdef\OfficerNameMentor{}\gdef\OfficerPostMentor{}
  \gdef\OfficerSalSeniorDeacon{}\gdef\OfficerNameSeniorDeacon{}\gdef\OfficerPostSeniorDeacon{}
  \gdef\OfficerSalJuniorDeacon{}\gdef\OfficerNameJuniorDeacon{}\gdef\OfficerPostJuniorDeacon{}
  \gdef\OfficerSalAssistantDirectorOfCeremonies{}\gdef\OfficerNameAssistantDirectorOfCeremonies{}\gdef\OfficerPostAssistantDirectorOfCeremonies{}
  \gdef\OfficerSalAssistantSecretary{}\gdef\OfficerNameAssistantSecretary{}\gdef\OfficerPostAssistantSecretary{}
  \gdef\OfficerSalInnerGuard{}\gdef\OfficerNameInnerGuard{}\gdef\OfficerPostInnerGuard{}
  \gdef\OfficerSalStewards{}\gdef\OfficerNameStewards{}\gdef\OfficerPostStewards{}
  \gdef\OfficerSalRoyalArchRepresentative{}\gdef\OfficerNameRoyalArchRepresentative{}\gdef\OfficerPostRoyalArchRepresentative{}
  \gdef\OfficerSalEventsCoordinator{}\gdef\OfficerNameEventsCoordinator{}\gdef\OfficerPostEventsCoordinator{}
  \gdef\OfficerSalMediaRepresentative{}\gdef\OfficerNameMediaRepresentative{}\gdef\OfficerPostMediaRepresentative{}
  \gdef\OfficerSalTyler{}\gdef\OfficerNameTyler{}\gdef\OfficerPostTyler{}
  \gdef\OfficerSalVisitingOfficer{}\gdef\OfficerNameVisitingOfficer{}\gdef\OfficerPostVisitingOfficer{}
% Canonical officer role list (single source of truth)
\newcommand{\OfficerRoleList}{%
  Master,Senior Warden,Junior Warden,Chaplain,Treasurer,Secretary,Director of Ceremonies,Almoner,Charity Steward,Membership Officer,Mentor,Senior Deacon,Junior Deacon,Assistant Director of Ceremonies,Assistant Secretary,Inner Guard,Stewards,Royal Arch Representative,Events Coordinator,Media Representative,Tyler,Visiting Officer%
}
% Colors
\definecolor{lodgeblue}{HTML}{004B8D}
\definecolor{lightgray}{gray}{0.4}

% Hyperref setup
\hypersetup{
  colorlinks=true,
  linkcolor=lodgeblue,
  urlcolor=lodgeblue
}

% Section formatting
  itleformat*{\section}{\large\bfseries\scshape\color{lodgeblue}}
  itlespacing*{\section}{0pt}{0.6\baselineskip}{0.35\baselineskip}

% Centered heading helper matching section style & spacing
\newcommand{\SectionStyle}{\large\bfseries\scshape\color{lodgeblue}}
\newcommand{\CenteredHeading}[1]{%
  \par\vspace{0.6\baselineskip}% same pre-skip as sections
  {\centering \SectionStyle #1\par}% centered title line
  \vspace{0.35\baselineskip}% same post-skip as sections
}

% List spacing
\setlist{itemsep=0.25\baselineskip, topsep=0.25\baselineskip}

% Table helpers
\newcolumntype{L}[1]{>{\raggedright\arraybackslash}p{#1}}
\newcolumntype{C}[1]{>{\centering\arraybackslash}p{#1}}
\newcolumntype{Y}{>{\raggedright\arraybackslash}X}
% Weighted X column for tabularx (proportional widths)
\makeatletter
\@ifundefined{NC@find@W}{\newcolumntype{W}[1]{>{\hsize=#1\hsize\raggedright\arraybackslash}X}}{}
\makeatother

% Shared table rule width, set per-table before drawing rules
\newlength{\TableWidth}
% Simple rule helpers drawn in vmode (avoid \noalign)
\newcommand{\TopRule}{\par\noindent\rule{\TableWidth}{0.9pt}\par\vspace{2pt}}
\newcommand{\MidRule}{\par\noindent\rule{\TableWidth}{0.5pt}\par\vspace{2pt}}
\newcommand{\BottomRule}{\par\noindent\rule{\TableWidth}{0.9pt}\par\vspace{2pt}}

% Honorary Members table from CSV (salutation, name, postnominals)
\newcommand{\HonoraryMembersTable}{%
  \begingroup
    \setlength{\tabcolsep}{2pt}% tight horizontal padding
    \renewcommand{\arraystretch}{0.95}% compact row height
    \centering\small
  \begin{minipage}{0.5\linewidth}
      \centering
      \begin{tabular}{@{}L{0.14\linewidth}L{0.56\linewidth}L{0.30\linewidth}@{}}%
      % Read simple three-column CSV: salutation,name,postnominals
      \csvreader[head to column names, separator=comma, respect all]{\DataDir/honorary_members.csv}{}{%
        \salutation & \name & \ifstrempty{\postnominals}{}{\postnominals} \\
      }%
      \end{tabular}%
    \end{minipage}%
  \endgroup
  \par\vspace{0.2\baselineskip}%
}

% Officers table from CSV
\newcommand{\OfficersTable}{%
  % Pretty label for some roles
  \newcommand{\PrettyRole}[1]{\IfStrEq{##1}{Master}{Worshipful Master}{##1}}%
  % Helper: print first matching row for a role, else blanks, scanning csv directly
  \newcommand{\OfficerRow}[1]{%
    \def\DesiredRole{##1}%
    \gdef\Printed{0}%
    \csvreader[head to column names, separator=comma, respect all]{\DataDir/officers.csv}{}{%
      \IfStrEq{\Printed}{0}{%
        \IfStrEq{\role}{\DesiredRole}{%
          \PrettyRole{\DesiredRole} & \salutation & \name\ifstrempty{\postnominals}{}{\space \postnominals} \\
          \gdef\Printed{1}%
        }{}%
      }{}%
    }%
    \IfStrEq{\Printed}{1}{}{\PrettyRole{\DesiredRole} & & \\}%
  }%
  \begingroup
  \setlength{\tabcolsep}{2.5pt}% extra-tight horizontal padding
  \renewcommand{\arraystretch}{0.95}% comfortable row height per request
    \centering\small
  \begin{tabular}{@{}L{0.30\linewidth}L{0.085\linewidth}L{0.615\linewidth}@{}}%
      \OfficerRow{Master}
      \OfficerRow{Senior Warden}
      \OfficerRow{Junior Warden}
      \OfficerRow{Chaplain}
      \OfficerRow{Treasurer}
      \OfficerRow{Secretary}
      \OfficerRow{Director of Ceremonies}
      \OfficerRow{Almoner}
      \OfficerRow{Charity Steward}
      \OfficerRow{Membership Officer}
      \OfficerRow{Mentor}
      \OfficerRow{Senior Deacon}
      \OfficerRow{Junior Deacon}
      \OfficerRow{Assistant Director of Ceremonies}
      \OfficerRow{Assistant Secretary}
      \OfficerRow{Inner Guard}
      \OfficerRow{Stewards}
      \OfficerRow{Royal Arch Representative}
      \OfficerRow{Events Coordinator}
      \OfficerRow{Media Representative}
      \OfficerRow{Tyler}
      \OfficerRow{Visiting Officer}
    \end{tabular}
  \endgroup
  \par\vspace{0.2\baselineskip}%
}

% Past Masters listing in flowing page columns (4 fields per row)
\newcommand{\PastMastersLegend}{%
  {\footnotesize
  \par\vspace{0.5\baselineskip}
  \noindent
    â€  = Deceased\quad F = Founder Member\quad R = Resigned\quad X = Excluded\quad H = Honorary\par}
}

\newcommand{\PastMastersTable}{%
  \begingroup
    \fontsize{6pt}{7.2pt}\selectfont
    % Column separation and spacing for multi-column layout
  \setlength{\columnsep}{10pt}
  \setlength{\parskip}{0pt}
  \setlength{\tabcolsep}{0.5pt}
  \setlength{\multicolsep}{4pt}% reduce vertical space around multicols
  \renewcommand{\arraystretch}{0.9}% slightly tighter rows
    \raggedcolumns
    \begin{multicols}{4}
      % Each row is a compact tabularx spanning the column width
      \csvreader[
        head to column names,
        separator=comma,
        respect all
      ]{\DataDir/past_masters.csv}{}{%
        % Ensure each row is its own paragraph so items stack down the column
        \par\noindent
        \begin{tabularx}{\linewidth}{@{}L{0.10\linewidth}C{0.10\linewidth}L{0.15\linewidth}Y@{}}%
          \year & \notes & \salutation & \name\ifstrempty{\postnominals}{}{\space \postnominals} \\
        \end{tabularx}%
        \par\vspace{-0.5pt}%
      }%
    \end{multicols}
    \PastMastersLegend
  \endgroup
}

% Default standard agenda if no per-meeting agenda exists
\newcommand{\StandardAgenda}{%
  \begin{enumerate}
    \item To open the Lodge.
    \item To confirm the minutes of the last Regular Meeting.
    \item To conduct any ballot(s).
    \item To conduct the business of the evening.
    \item To collect alms.
    \item To close the Lodge.
  \end{enumerate}%
}
